---
title: 发送短信倒计时60s
categories: 集成
tags:
  - vue
  - 常用的方法
---

## 实现的功能

手机登录需要验证码，或者忘记密码时需要发送验证码，点击“发送(Send code）”按钮请求后端验证码，并显示 60s 倒计时，当 60s 倒计时结束之后显示“再次发送(Resend code)”。

#### Template

```html
<el-input v-model="code" :placeholder="t('Enter 6-digit code')">
  <template #suffix>
    <div class="send_box" @click="sendCode">{{ countText }}</div>
  </template>
</el-input>
```

#### JS 部分

```javascript
const code = ref("")
const codeTime = ref(60) //60s倒计时
const timer = ref()
const isFirstSend = ref(true)

// 按钮的文字
const countText = computed(() => {
  if (codeTime.value < 60 && codeTime.value > 0) {
    return `${codeTime.value}s`
  } else {
    if (isFirstSend.value) {
      return "Send code"
    } else {
      return "Resend code"
    }
  }
})


// 发送验证码
const sendCode = () => {
  if (timer.value) return
  // 获取验证码
  getEmailCode({
    scene: 7,
    email: email.value,
  }).then((res) => {
    if (res.data) {
      setTimeout(() => {
        isFirstSend.value = false // 解决点击按钮之后要过一秒才会出现倒计时的问题
      }, 1000)
      codeTime.value = 60
      timer.value = setInterval(() => {
        if (codeTime.value <= 0) {
          clearInterval(timer.value)
          timer.value = null
          return
        }
        codeTime.value--
      }, 1000)
    }
  })
}
```
